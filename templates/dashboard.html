{% extends "base.html" %}
{% block content %}
<h2>Dashboard {% if is_premium %}<span class="premium-badge">Premium</span>{% else %}(Free){% endif %}</h2>

{% if not is_premium %}
<p style="color:red;">You are Free user. Upgrade untuk fitur penuh.</p>
<a href="{{ url_for('upgrade') }}">Upgrade Now</a>
{% endif %}

{% if warning_msg %}
<div class="collision-warning">{{ warning_msg }}</div>
{% endif %}

<div class="stress-box {{ stress_color }}">
    <h3>Weekly Stress Level</h3>
    <p class="stress-level">
        {{ stress_level }}
    </p>
    <small>Based on your tasks this week</small>
</div>

<h3>Add Task</h3>
{% if not is_premium and tasks|length >=5 %}
<p style="color:red;">Free user maksimal 5 task. Upgrade untuk menambah lebih banyak task.</p>
{% else %}
<form id="task-form">
    <input type="text" name="title" placeholder="Task title" required>
    <input type="date" name="deadline" required>
    <input type="number" name="sks" placeholder="SKS" required>
    <select name="jenis">
        <option value="kuis">Kuis</option>
        <option value="uts">UTS</option>
        <option value="uas">UAS</option>
        <option value="proyek">Proyek</option>
    </select>
    <input type="number" name="estimasi" placeholder="Estimasi waktu (jam)" required>
    <button type="submit">Add Task</button>
</form>
{% endif %}

<h3>Your Tasks by Course</h3>

{% for course, tasks in grouped_tasks.items() %}
<div class="course-box">
    <h4>ğŸ“˜ {{ course }}</h4>

    <table>
        <tr>
            <th>Title</th>
            <th>Deadline</th>
            <th>Priority</th>
            <th>Progress</th>
            <th>Action</th>
        </tr>

        {% for task in tasks %}
        <tr data-task-id="{{ task.id }}">
            <td>{{ task.title }}</td>
            <td>{{ task.deadline }}</td>
            <td>{{ task.priority }}</td>
            <td>
                {{ task.progress if task.progress else "0%" }}
            </td>
            <td>
                {% if is_premium %}
                <button class="delete-task">ğŸ—‘ï¸</button>
                <button class="edit-task">âœï¸</button>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endfor %}

</table>
{% endblock %}
